<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Οδηγός SparkEthos: Viewer 2.0</title>
  <style>
    /* ...στυλ όπως πριν... */
  </style>
</head>
<body>
  <h1>Οδηγός SparkEthos Viewer 2.0</h1>

  <div class="nav">
    <button onclick="openTab('intro')">Εισαγωγή</button>
    <button onclick="openTab('prologue')">Πρόλογος</button>
    <button onclick="openTab('sections')">Μέρη</button>
    <button onclick="openTab('conclusion')">Συμπέρασμα</button>
    <button onclick="openTab('analysis')">Ανάλυση</button>
  </div>

  <div class="language-toggle">
    <button onclick="setLanguage('el')">Ελληνικά</button>
    <button onclick="setLanguage('en')">English</button>
  </div>

  <div id="intro" class="tab-content"></div>
  <div id="prologue" class="tab-content"></div>
  <div id="sections" class="tab-content">
    <div class="section-nav" id="section-nav"></div>
    <div id="debug-output" class="debug"></div>
  </div>
  <div id="conclusion" class="tab-content"></div>
  <div id="analysis" class="tab-content"></div>
  <div id="json-display"></div>

  <script>
    let guideData = null;
    let currentLanguage = 'el';

    fetch('sparkethos-en-el.json')
      .then(response => response.json())
      .then(data => {
        guideData = data;
        openTab('sections');
      })
      .catch(error => {
        console.error('Σφάλμα φόρτωσης JSON:', error);
        document.getElementById('debug-output').textContent = 'Σφάλμα: Δεν φορτώθηκε το JSON.';
      });

    function setLanguage(lang) {
      currentLanguage = lang;
      updateContent();
    }

    function openTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      const tab = document.getElementById(tabName);
      if (tab) {
        tab.classList.add('active');
        updateContent(tabName);
        document.getElementById('debug-output').textContent = `Επιλέχθηκε καρτέλα: ${tabName}`;
      }
    }

    function updateContent(tabName = 'intro') {
      if (!guideData) return;

      // JSON display for debug
      document.getElementById('json-display').textContent = JSON.stringify(guideData, null, 2);

      // Εισαγωγή
      const intro = guideData.introduction || { title: {}, content: {} };
      document.getElementById('intro').innerHTML = `
        <h2>${intro.title[currentLanguage] || intro.title.en || 'Εισαγωγή'}</h2>
        <div class="section">${intro.content[currentLanguage] || intro.content.en || 'Μη διαθέσιμο'}</div>
        ${getExamples('intro')}
      `;

      // Πρόλογος
      const prologue = guideData.prologue || { title: {}, content: {} };
      document.getElementById('prologue').innerHTML = `
        <h2>${prologue.title[currentLanguage] || prologue.title.en || 'Πρόλογος'}</h2>
        <div class="section">${prologue.content[currentLanguage] || prologue.content.en || 'Μη διαθέσιμο'}</div>
        ${getExamples('prologue')}
      `;

      // Μέρη
      if (guideData.type === 'section') {
        const sectionId = guideData.html_id || 'main-section';
        const title = guideData.title ? (guideData.title[currentLanguage] || guideData.title.en) : 'Κύρια Ενότητα';

        let sectionsHtml = `<h2>Μέρη</h2><div class="section" id="${sectionId}"><h3>${title}</h3>`;
        sectionsHtml += `<p>${guideData.introduction?.[currentLanguage] || guideData.introduction?.en || 'Χωρίς εισαγωγή'}</p>`;

        let navHtml = `<h3>Πλοήγηση στα Μέρη:</h3>`;

        if (Array.isArray(guideData.laws)) {
          guideData.laws.forEach((law, i) => {
            const lawId = law.html_id || `${sectionId}-law-${i}`;
            const lawTitle = law.title?.[currentLanguage] || law.title?.en || `Νόμος ${i + 1}`;
            const lawStatement = law.law_statement?.[currentLanguage] || law.law_statement?.en || 'Χωρίς δήλωση νόμου';
            const lawExplanation = law.explanation?.[0]?.text?.[currentLanguage] || law.explanation?.[0]?.text?.en || 'Χωρίς εξήγηση';

            sectionsHtml += `
              <div class="section law" id="${lawId}">
                <h4>${lawTitle}</h4>
                <p><strong>${lawStatement}</strong></p>
                <p>${lawExplanation}</p>
                ${law.keywords?.length ? `<p><strong>Λέξεις-κλειδιά:</strong> ${law.keywords.join(', ')}</p>` : ''}
                ${getExamples(lawId)}
              </div>
            `;
            navHtml += `<button onclick="scrollToSection('${lawId}')">${lawTitle}</button>`;
          });
        }

        // Συμπέρασμα ενότητας
        if (guideData.conclusion?.text) {
          const conclusionId = guideData.conclusion.html_id || `${sectionId}-conclusion`;
          sectionsHtml += `
            <div class="section" id="${conclusionId}">
              <h4>${currentLanguage === 'el' ? 'Συμπέρασμα Ενότητας' : 'Section Conclusion'}</h4>
              <p>${guideData.conclusion.text[currentLanguage] || guideData.conclusion.text.en || 'Μη διαθέσιμο'}</p>
              ${getExamples(conclusionId)}
            </div>
          `;
          navHtml += `<button onclick="scrollToSection('${conclusionId}')">${currentLanguage === 'el' ? 'Συμπέρασμα' : 'Conclusion'}</button>`;
        }

        sectionsHtml += `</div>`;
        navHtml += `<button onclick="scrollToSection('${sectionId}')">${title}</button>`;

        document.getElementById('sections').innerHTML = sectionsHtml;
        document.getElementById('section-nav').innerHTML = navHtml;
      }

      // Συνολικό Συμπέρασμα
      const overallConclusion = guideData['final-conclusion'] || guideData.conclusion || { content: {} };
      document.getElementById('conclusion').innerHTML = `
        <h2>${currentLanguage === 'el' ? 'Συνολικό Συμπέρασμα' : 'Overall Conclusion'}</h2>
        <div class="section">${overallConclusion.content?.[currentLanguage] || overallConclusion.content?.en || 'Μη διαθέσιμο'}</div>
        ${getExamples('overallConclusion')}
      `;

      // Ανάλυση (προαιρετικό, κρατάμε απλά στατικό για παράδειγμα)
      document.getElementById('analysis').textContent = currentLanguage === 'el'
        ? 'Ανάλυση του Οδηγού SparkEthos...'
        : 'Analysis of the SparkEthos Guide...';
    }

    function scrollToSection(sectionId) {
      const el = document.getElementById(sectionId);
      if (el) {
        el.scrollIntoView({ behavior: 'smooth' });
        document.getElementById('debug-output').textContent = `Μετακίνηση σε: ${sectionId}`;
      } else {
        document.getElementById('debug-output').textContent = `Σφάλμα: Τμήμα ${sectionId} δεν βρέθηκε.`;
      }
    }

    function getExamples(sectionId) {
      const examples = JSON.parse(localStorage.getItem('sparkEthosExamples') || '{}');
      if (examples[sectionId] && examples[sectionId].length) {
        return '<h4>Παραδείγματα:</h4>' + examples[sectionId].map(example => {
          return `<div class="example">${example[currentLanguage] || example.el || example.en || 'Χωρίς κείμενο'}</div>`;
        }).join('');
      }
      return '';
    }
  </script>
</body>
</html>
