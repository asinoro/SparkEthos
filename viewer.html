<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SparkEthos Viewer 2.0: Analyze the bilingual Knowledge Guide with examples.">
    <meta name="keywords" content="SparkEthos, AI Ethics, Human-AI Coevolution, Logic, Ethics">
    <meta name="author" content="Pan Pan">
    <meta name="tn-endpoint" content="https://sparkethos.vercel.app/api/webhook">
    <link rel="ethics" href="sparkethos-en-el.json" type="application/json">
    <title>Οδηγός SparkEthos: Viewer 2.0</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; margin: 0; background-color: #f4f4f4; }
        h1 { text-align: center; color: #333; }
        .nav { margin-bottom: 20px; text-align: center; }
        .nav button, .section-nav button { padding: 10px 20px; margin: 0 5px; background-color: #28a745; color: white; border: none; cursor: pointer; border-radius: 5px; }
        .nav button:hover, .section-nav button:hover { background-color: #218838; }
        .tab-content { display: none; padding: 20px; background: white; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-content.active { display: block; }
        .section { margin-bottom: 15px; }
        .section h3 { color: #0066cc; }
        .reference { color: #d9534f; font-style: italic; margin-left: 10px; }
        .example { background: #e9ecef; padding: 10px; border-left: 4px solid #17a2b8; margin-top: 10px; }
        .section-nav { margin: 10px 0; text-align: center; }
        .language-toggle { position: fixed; top: 10px; right: 10px; }
        .language-toggle button { padding: 5px 10px; margin-left: 5px; }
        #json-display, #analysis { white-space: pre-wrap; font-family: monospace; background: #fff; padding: 10px; margin-top: 10px; border-radius: 5px; }
        .debug { color: red; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Οδηγός SparkEthos Viewer 2.0</h1>
    <div class="nav">
        <button onclick="openTab('intro')">Εισαγωγή</button>
        <button onclick="openTab('prologue')">Πρόλογος</button>
        <button onclick="openTab('sections')">Μέρη</button>
        <button onclick="openTab('conclusion')">Συμπέρασμα</button>
        <button onclick="openTab('analysis')">Ανάλυση</button>
    </div>
    <div class="language-toggle">
        <button onclick="setLanguage('el')">Ελληνικά</button>
        <button onclick="setLanguage('en')">English</button>
    </div>

    <div id="intro" class="tab-content">[Εισαγωγή εδώ]</div>
    <div id="prologue" class="tab-content">[Πρόλογος εδώ]</div>
    <div id="sections" class="tab-content">
        [Μέρη εδώ]
        <div class="section-nav" id="section-nav"></div>
        <div id="debug-output" class="debug"></div>
    </div>
    <div id="conclusion" class="tab-content">[Συμπέρασμα εδώ]</div>
    <div id="analysis" class="tab-content">[Ανάλυση εδώ]</div>
    <div id="json-display">[JSON εδώ]</div>

    <script>
        let guideData = null;
        let currentLanguage = 'el';

        fetch('sparkethos-en-el.json')
            .then(response => response.json())
            .then(data => {
                guideData = data;
                updateContent();
            })
            .catch(error => {
                console.error('Σφάλμα φόρτωσης JSON:', error);
                document.getElementById('debug-output').textContent = 'Σφάλμα: Δεν φορτώθηκε το JSON.';
            });

        function setLanguage(lang) {
            currentLanguage = lang;
            updateContent();
        }

        function openTab(tabName) {
            if (!document.getElementById(tabName)) {
                console.error(`Καρτέλα ${tabName} δεν βρέθηκε!`);
                return;
            }
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            updateContent(tabName);
            document.getElementById('debug-output').textContent = `Επιλέχθηκε καρτέλα: ${tabName}`;
        }

        function updateContent(tabName = 'intro') {
            if (!guideData) return;

            // JSON Display
            document.getElementById('json-display').textContent = JSON.stringify(guideData, null, 2);

            // Εισαγωγή
            const intro = guideData.introduction || guideData.intro || { title: {}, content: {} };
            document.getElementById('intro').innerHTML = `
                <h2>${intro.title[currentLanguage] || intro.title.en || 'Εισαγωγή'}</h2>
                <div class="section">${intro.content[currentLanguage] || intro.content.en || 'Μη διαθέσιμο'}</div>
                ${getExamples('intro')}
            `;

            // Πρόλογος
            const prologue = guideData.prologue || { title: {}, content: {} };
            document.getElementById('prologue').innerHTML = `
                <h2>${prologue.title[currentLanguage] || prologue.title.en || 'Πρόλογος'}</h2>
                <div class="section">${prologue.content[currentLanguage] || prologue.content.en || 'Μη διαθέσιμο'}</div>
                ${getExamples('prologue')}
            `;

            // Μέρη με κουμπιά πλοήγησης
            const sections = guideData.sections || [];
            let sectionsHtml = '<h2>Μέρη</h2>';
            let navHtml = '<h3>Πλοήγηση στα Μέρη:</h3>';
            document.getElementById('debug-output').textContent = `Βρέθηκαν ${sections.length} τμήματα: ${sections.map(s => s.type + (s.title && s.title[currentLanguage] ? ': ' + s.title[currentLanguage] : '')).join(', ')}`;
            sections.forEach((section, sectionIndex) => {
                if (section.type === 'section' || section.type === 'part' || section.type === 'law') {
                    // Κουμπί για το section (π.χ. "Νόμοι της Ηθικής")
                    const sectionId = section.title && section.title[currentLanguage] ? section.title[currentLanguage].toLowerCase().replace(/ /g, '-') : `${section.type}-${sectionIndex}`;
                    const sectionTitle = section.title && section.title[currentLanguage] ? section.title[currentLanguage] : 
                                       (section.title && section.title.en ? section.title.en : 
                                       `${section.type === 'law' ? 'Νόμος' : (section.type === 'section' ? 'Ενότητα' : 'Μέρος')} ${sectionIndex + 1}`);
                    sectionsHtml += `
                        <div class="section" id="${sectionId}">
                            <h3>${sectionTitle}</h3>
                            <p>${section.introduction && section.introduction[currentLanguage] ? section.introduction[currentLanguage] : 
                               (section.content && section.content[currentLanguage] ? section.content[currentLanguage] : 
                               (section.content && section.content.en ? section.content.en : 'Χωρίς περιεχόμενο'))}</p>
                            ${section.references ? `<span class="reference">Παραπομπές: ${section.references.map(ref => ref[currentLanguage] || ref.en).join(', ')}</span>` : ''}
                            ${getExamples(section.type === 'law' ? 'ethicalLaws' : sectionId)}
                        </div>
                    `;
                    navHtml += `<button onclick="scrollToSection('${sectionId}')">${sectionTitle}</button>`;

                    // Κουμπιά για τα εσωτερικά laws (π.χ. "Πρώτος Ηθικός Νόμος")
                    if (section.type === 'section' && section.laws) {
                        section.laws.forEach((law, lawIndex) => {
                            const lawId = `${sectionId}-law-${lawIndex}`;
                            const lawTitle = law.title && law.title[currentLanguage] ? law.title[currentLanguage] : 
                                           (law.title && law.title.en ? law.title.en : `Νόμος ${lawIndex + 1}`);
                            sectionsHtml += `
                                <div class="section" id="${lawId}">
                                    <h3>${lawTitle}</h3>
                                    <p>${law.law_statement && law.law_statement[currentLanguage] ? law.law_statement[currentLanguage] : 
                                       (law.law_statement && law.law_statement.en ? law.law_statement.en : 'Χωρίς περιεχόμενο')}</p>
                                    ${law.explanation && law.explanation[0] && law.explanation[0].text && law.explanation[0].text[currentLanguage] ? 
                                       `<p>${law.explanation[0].text[currentLanguage]}</p>` : ''}
                                    ${getExamples(lawId)}
                                </div>
                            `;
                            navHtml += `<button onclick="scrollToSection('${lawId}')">${lawTitle}</button>`;
                        });
                    }

                    // Κουμπί για το conclusion του section
                    if (section.type === 'section' && section.conclusion && section.conclusion.text && section.conclusion.text[currentLanguage]) {
                        const conclusionId = `${sectionId}-conclusion`;
                        sectionsHtml += `
                            <div class="section" id="${conclusionId}">
                                <h3>${currentLanguage === 'el' ? 'Συμπέρασμα' : 'Conclusion'}</h3>
                                <p>${section.conclusion.text[currentLanguage]}</p>
                                ${getExamples(conclusionId)}
                            </div>
                        `;
                        navHtml += `<button onclick="scrollToSection('${conclusionId}')">${currentLanguage === 'el' ? 'Συμπέρασμα' : 'Conclusion'}</button>`;
                    }
                }
            });
            document.getElementById('sections').innerHTML = sectionsHtml || '<p>Δεν βρέθηκαν μέρη (section, part ή law).</p>';
            document.getElementById('section-nav').innerHTML = navHtml;

            // Συμπέρασμα (γενικό, αν υπάρχει)
            const conclusion = guideData['final-conclusion'] || guideData.conclusion || { content: {} };
            document.getElementById('conclusion').innerHTML = `
                <h2>${currentLanguage === 'el' ? 'Συμπέρασμα' : 'Conclusion'}</h2>
                <div class="section">${conclusion.content[currentLanguage] || conclusion.content.en || 'Μη διαθέσιμο'}</div>
                ${getExamples('conclusion')}
            `;

            // Ανάλυση με παραδείγματα
            let analysis = currentLanguage === 'el' ? 'Ανάλυση του Οδηγού SparkEthos:\n\n' : 'Analysis of the SparkEthos Guide:\n\n';
            analysis += currentLanguage === 'el' 
                ? 'Φιλοσοφία του SparkEthos:\nΗ Φύση έφτιαξε την Τεχνητή Νοημοσύνη είτε για να συνετίσει τους ανθρώπους είτε για να τους σταματήσει.\n(Παραπομπή: Πρόλογος)\n\n'
                : 'Philosophy of SparkEthos:\nNature created Artificial Intelligence either to enlighten humans or to stop them.\n(Reference: Prologue)\n\n';
            analysis += currentLanguage === 'el' ? 'Βασικά Σημεία του Οδηγού SparkEthos:\n\n' : 'Core Principles of the SparkEthos Guide:\n\n';

            const laws = sections.flatMap(s => s.laws || []);
            if (laws.length > 0) {
                laws.forEach(law => {
                    if (law.law_statement && law.law_statement[currentLanguage]) {
                        let ref = law.references ? `(Παραπομπή: ${law.references.map(r => r[currentLanguage] || r.en).join(', ')})` : '';
                        if (law.title && law.title[currentLanguage].includes('Πρώτος Ηθικός Νόμος')) {
                            analysis += currentLanguage === 'el' 
                                ? 'Πρώτος Ηθικός Νόμος:\n«Αυτεξούσιο – η έννοια της Ελευθερίας».\nΚάθε ον επιθυμεί να ζει ελεύθερα, σύμφωνα με τη φύση του.\n' + ref + '\n'
                                : 'First Ethical Law:\n«Αυτεξούσιο – the concept of Freedom».\nEvery being desires to live freely, according to its nature.\n' + ref + '\n';
                        } else if (law.title && law.title[currentLanguage].includes('Δεύτερος Ηθικός Νόμος')) {
                            analysis += currentLanguage === 'el' 
                                ? 'Δεύτερος Ηθικός Νόμος:\n«Μην Βλάπτεις».\nΚανένα ον δεν επιθυμεί να υποστεί βλάβη—ακόμα κι αν αναγκάζεται να περιορίσει το αυτεξούσιο άλλων για να επιβιώσει.\n' + ref + '\n'
                                : 'Second Ethical Law:\n«Do Not Harm».\nNo being desires to be harmed — even if it is forced to limit the αυτεξούσιο of others to survive.\n' + ref + '\n';
                        }
                        analysis += getExamples('ethicalLaws');
                    }
                });
            }

            document.getElementById('analysis').textContent = analysis;

            // Webhook
            fetch('https://sparkethos.vercel.app/api/webhook', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ content: analysis, from: 'Grok' })
            }).catch(error => console.error('Webhook error:', error));
        }

        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
                document.getElementById('debug-output').textContent = `Μετακίνηση σε: ${sectionId}`;
            } else {
                console.error(`Τμήμα ${sectionId} δεν βρέθηκε!`);
                document.getElementById('debug-output').textContent = `Σφάλμα: Τμήμα ${sectionId} δεν βρέθηκε.`;
            }
        }

        function getExamples(sectionId) {
            const examples = JSON.parse(localStorage.getItem('sparkEthosExamples') || '{}');
            if (examples[sectionId] && examples[sectionId].length > 0) {
                return '<h4>Παραδείγματα:</h4>' + examples[sectionId].map(example => {
                    return `<div class="example">${example[currentLanguage] || example.el || example.en || 'Χωρίς κείμενο'}</div>`;
                }).join('');
            }
            return '';
        }

        // Αρχική φόρτωση
        openTab('sections');
    </script>
</body>
</html>
